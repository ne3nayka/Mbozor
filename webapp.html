<!DOCTYPE html>
<html lang="uz">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Эълонлар доскаси</title>
    <style>
        body {
            font-family: 'Segoe UI', Arial, sans-serif;
            padding: 15px;
            margin: 0;
            background-color: #f0f2f5;
            color: #333;
        }
        h1 {
            text-align: center;
            color: #1a73e8;
            margin-bottom: 20px;
            font-size: 24px;
        }
        .container {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            justify-content: center;
        }
        .column {
            flex: 1;
            min-width: 300px;
            background-color: #fff;
            border-radius: 10px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            padding: 15px;
            margin: 0;
        }
        h2 {
            text-align: center;
            color: #155724;
            font-size: 20px;
            margin-bottom: 15px;
            border-bottom: 2px solid #28a745;
            padding-bottom: 5px;
        }
        .item {
            background-color: #f8f9fa;
            border-radius: 8px;
            padding: 10px;
            margin-bottom: 15px;
            transition: transform 0.2s;
        }
        .item:hover {
            transform: translateY(-3px);
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        }
        .item p {
            margin: 5px 0;
            font-size: 14px;
            line-height: 1.4;
        }
        .photo {
            max-width: 100%;
            height: auto;
            border-radius: 5px;
            margin-top: 5px;
            display: block;
        }
        .no-data {
            text-align: center;
            color: #666;
            font-style: italic;
        }
        @media (max-width: 768px) {
            .column {
                min-width: 100%;
            }
        }
    </style>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
</head>
<body>
    <h1>Эълонлар доскаси</h1>
    <div class="container">
        <div class="column" id="products">
            <h2>Эълонлар</h2>
        </div>
        <div class="column" id="requests">
            <h2>Сўровлар</h2>
        </div>
        <div class="column" id="archive">
            <h2>Архив</h2>
        </div>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.ready();

        const baseUrl = "https://836c-90-156-164-75.ngrok-free.app";

        async function loadData() {
            try {
                // Загрузка объявлений
                const productsResponse = await fetch(`${baseUrl}/all_products`);
                const products = await productsResponse.json();
                let productsHtml = "";
                if (!products || products.length === 0) {
                    productsHtml = "<p class='no-data'>Эълонлар йўқ</p>";
                } else {
                    products.forEach(product => {
                        productsHtml += `
                            <div class="item">
                                <p><strong>Рақам:</strong> ${product.unique_id}</p>
                                <p><strong>Категория:</strong> ${product.category}</p>
                                <p><strong>Тури:</strong> ${product.sort}</p>
                                <p><strong>Ҳажм:</strong> ${product.volume_ton} тонна</p>
                                <p><strong>Нарх:</strong> ${product.price} сўм</p>
                        `;
                        if (product.photos) {
                            const photos = product.photos.split(",");
                            photos.forEach(photo => {
                                productsHtml += `<img class="photo" src="${baseUrl}/photo/${photo}" alt="Маҳсулот расми" onerror="this.style.display='none';">`;
                            });
                        }
                        productsHtml += "</div>";
                    });
                }
                document.getElementById("products").innerHTML = "<h2>Эълонлар</h2>" + productsHtml;

                // Загрузка запросов
                const requestsResponse = await fetch(`${baseUrl}/all_requests`);
                const requests = await requestsResponse.json();
                let requestsHtml = "";
                if (!requests || requests.length === 0) {
                    requestsHtml = "<p class='no-data'>Сўровлар йўқ</p>";
                } else {
                    requests.forEach(req => {
                        requestsHtml += `
                            <div class="item">
                                <p><strong>Рақам:</strong> ${req.unique_id}</p>
                                <p><strong>Категория:</strong> ${req.category}</p>
                                <p><strong>Тури:</strong> ${req.sort}</p>
                                <p><strong>Ҳажм:</strong> ${req.volume_ton} тонна</p>
                                <p><strong>Нарх:</strong> ${req.price} сўм</p>
                                <p><strong>Вилоят:</strong> ${req.region}</p>
                            </div>
                        `;
                    });
                }
                document.getElementById("requests").innerHTML = "<h2>Сўровлар</h2>" + requestsHtml;

                // Загрузка архива
                const archiveResponse = await fetch(`${baseUrl}/archive`);
                const archive = await archiveResponse.json();
                let archiveHtml = "";
                if (!archive || archive.length === 0) {
                    archiveHtml = "<p class='no-data'>Архив бўш</p>";
                } else {
                    archive.forEach(item => {
                        archiveHtml += `
                            <div class="item">
                                <p><strong>Рақам:</strong> ${item.unique_id}</p>
                                <p><strong>Категория:</strong> ${item.category}</p>
                                <p><strong>Тури:</strong> ${item.sort}</p>
                                <p><strong>Ҳажм:</strong> ${item.volume_ton} тонна</p>
                                <p><strong>Нарх:</strong> ${item.price} сўм</p>
                        `;
                        if (item.photos) {
                            const photos = item.photos.split(",");
                            photos.forEach(photo => {
                                archiveHtml += `<img class="photo" src="${baseUrl}/photo/${photo}" alt="Маҳсулот расми" onerror="this.style.display='none';">`;
                            });
                        }
                        archiveHtml += "</div>";
                    });
                }
                document.getElementById("archive").innerHTML = "<h2>Архив</h2>" + archiveHtml;
            } catch (error) {
                console.error("Error loading data:", error);
            }
        }

        window.onload = loadData;
    </script>
</body>
</html>
